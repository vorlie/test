<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Material You Theme Generator</title>
        <meta name="description" content="">'
        <meta property="og:title" content="Material You Theme Generator">
        <meta property="og:type" content="website">
        <meta property="og:description" content="Temporary homepage for ushie's Material You Theme Generator">
        <meta property="og:url" content="https://materialdetta.vorlie.pl">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <base href="/">
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    </head>
    <body>
        <div class="main">
          <div class="title">
            <p>Material You Theme Generator</p>
          </div>
          <div class="login-outher">
            <p class="login-title">Fetch color from your Discord avatar</p>
            <div class="login-inner">
                  <img src='' id="avatar"/>
                  <div id="name"></div>
              <a href="/" class="text-sm mt-5">Logout</a>
            </div>
          </div>
          <div class="pickers">
            <div class="file-image">
              <input type="file" id="fileInput" class="file-input" accept="image/*">
              <label for="fileInput" class="custom-button">Choose an image</label>
            </div>
            <input type="text" id="hexColorInput" name="hex-color" placeholder="#ff0000">
            <button id="generate">Generate</button>
            <div class="client-dropdown">
              <select id="clients">
                <option value="vendetta">Vendetta</option>
                <option value="vencord">Vencord</option>
                <option value="aliucord">Aliucord</option>
              </select>
            </div>
          </div>
          <div class="theme-link">
            <p>Generated Theme Link</p>
            <div class="theme-link-area">
              <input type="text" id="gen-theme-link" readonly placeholder="Generated theme link goes here"> 
            </div>
          </div>
          <p class="small-title">Currently, Vendetta is supported, other clients will have to unfortunately wait until the support is added.</p>
        </div>
    <script src="/src/js/script.js"></script>
    <script>
 
      window.onload = () => {
        const fragment = new URLSearchParams(window.location.hash.slice(1));
        const [accessToken, tokenType] = [fragment.get('access_token'), fragment.get('token_type')];

        if (!accessToken) {
          window.location.href('/');
        }

        fetch('https://discord.com/api/users/@me', {
          headers: {
            authorization: `${tokenType} ${accessToken}`,
          },
        })
          .then((result) => result.json())
          .then(async (response) => {
            const { username, avatar, id } = response;
            document.getElementById('name').innerText = ` ${username}`;
            document.getElementById('avatar').src = `https://cdn.discordapp.com/avatars/${id}/${avatar}.jpg`;

            const avatarUrl = `https://cdn.discordapp.com/avatars/${id}/${avatar}.jpg`;
            const avatarColor = await fetchAvatarColor(avatarUrl);
            updateColors(avatarColor);
          })
          .catch(console.error);
      };
    </script>
    </body>
</html>